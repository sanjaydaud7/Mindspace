<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Profile - MindSpace</title>

        <!-- Favicon -->
        <link rel="apple-touch-icon" sizes="180x180" href="images/ico.png">
        <link rel="icon" type="image/png" sizes="32x32" href="images/ico.png">
        <link rel="icon" type="image/png" sizes="16x16" href="images/ico.png">

        <!-- Fonts -->
        <link
            href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
            rel="stylesheet">
        <link rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

        <!-- Stylesheets -->
        <link rel="stylesheet" href="styles.css">
        <style>
        /* Profile Page Specific Styles */

.profile-container {
    padding: 20px 0;
    min-height: calc(100vh - 80px);
    background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
}

/* Profile Completion Notice */
.profile-completion-notice {
    background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
    color: white;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
    animation: slideInFromTop 0.5s ease-out;
}

.completion-content {
    display: flex;
    align-items: center;
    gap: 20px;
}

.completion-content i {
    font-size: 32px;
    opacity: 0.9;
}

.completion-text h3 {
    font-size: 20px;
    font-weight: 600;
    margin: 0 0 5px 0;
}

.completion-text p {
    margin: 0;
    opacity: 0.9;
    font-size: 14px;
}

.completion-progress {
    margin-left: auto;
}

.progress-circle {
    width: 60px;
    height: 60px;
    border: 3px solid rgba(255, 255, 255, 0.3);
    border-top: 3px solid white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    font-size: 14px;
    position: relative;
}

@keyframes slideInFromTop {
    from { transform: translateY(-30px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
}

/* Welcome Section */
.welcome-section {
    background: linear-gradient(135deg, #4073c0 0%, #667eea 100%);
    color: white;
    border-radius: 16px;
    padding: 20px 40px;
    margin-bottom: 20px;
    box-shadow: 0 8px 30px rgba(64, 115, 192, 0.2);
    position: relative;
    overflow: hidden;
}

.welcome-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 30px;
}

.welcome-text h1 {
    font-size: 32px;
    font-weight: 700;
    margin-bottom: 5px;
    letter-spacing: 0.5px;
}

.welcome-text p {
    opacity: 0.9;
    font-size: 17px;
    font-weight: 400;
    margin: 0;
}

/* Profile Completion Notice in Welcome Section */
.welcome-section .profile-completion-notice {
    background: rgba(255, 255, 255, 0.15);
    border: 1px solid rgba(255, 255, 255, 0.2);
    padding: 20px;
    border-radius: 12px;
    backdrop-filter: blur(10px);
    min-width: 280px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
}

.welcome-section .completion-content {
    display: flex;
    align-items: center;
    gap: 15px;
}

.welcome-section .completion-content i {
    font-size: 24px;
    color: #ffb700;
}

.welcome-section .completion-text h4 {
    font-size: 16px;
    font-weight: 600;
    margin: 0 0 5px 0;
}

.welcome-section .completion-text p {
    margin: 0;
    font-size: 12px;
    opacity: 0.8;
}

.welcome-section .progress-circle {
    width: 50px;
    height: 50px;
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-top: 2px solid #ffb700;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    font-size: 12px;
}

/* Profile Sections */
.profile-sections {
    display: flex;
    flex-direction: column;
    gap: 35px;
}

.profile-section {
    background: white;
    border-radius: 16px;
    box-shadow: 0 4px 25px rgba(0, 0, 0, 0.08);
    overflow: hidden;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    border: 1px solid rgba(226, 232, 240, 0.8);
}

.profile-section:hover {
    box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
    transform: translateY(-3px);
    border-color: rgba(64, 115, 192, 0.2);
}

.section-header {
    background: linear-gradient(135deg, #4073c0 0%, #667eea 100%);
    color: white;
    padding: 25px 35px;
    border-bottom: none;
    position: relative;
    overflow: hidden;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.section-header::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.1) 50%, transparent 70%);
    transform: translateX(-100%);
    transition: transform 0.6s;
}

.profile-section:hover .section-header::before {
    transform: translateX(100%);
}

.section-header h2 {
    font-size: 22px;
    font-weight: 700;
    margin: 0;
    display: flex;
    align-items: center;
    gap: 12px;
    letter-spacing: 0.5px;
}

.section-header i {
    font-size: 20px;
    opacity: 0.9;
}

/* Section Action Buttons */
.section-actions {
    display: flex;
    gap: 12px;
    align-items: center;
    z-index: 2;
    position: relative;
}

.section-actions button {
    padding: 8px 16px;
    border-radius: 8px;
    font-weight: 600;
    font-size: 14px;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    display: flex;
    align-items: center;
    gap: 6px;
    border: none;
    cursor: pointer;
    letter-spacing: 0.3px;
}

.section-actions .btn-edit {
    background: rgba(255, 255, 255, 0.2);
    color: white;
    border: 1px solid rgba(255, 255, 255, 0.3);
}

.section-actions .btn-edit:hover {
    background: rgba(255, 255, 255, 0.3);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
}

.section-actions .btn-save {
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    color: white;
    box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
}

.section-actions .btn-save:hover {
    background: linear-gradient(135deg, #059669 0%, #047857 100%);
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);
}

.section-actions .btn-cancel {
    background: rgba(239, 68, 68, 0.9);
    color: white;
    box-shadow: 0 2px 8px rgba(239, 68, 68, 0.3);
}

.section-actions .btn-cancel:hover {
    background: rgba(220, 38, 38, 0.9);
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(239, 68, 68, 0.4);
}

.section-content {
    padding: 40px 35px;
}

/* Form Grid */
.form-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 30px;
    margin-bottom: 40px;
}

.form-group {
    display: flex;
    flex-direction: column;
    position: relative;
}

.form-group label {
    font-weight: 600;
    color: #1f2937;
    margin-bottom: 10px;
    font-size: 14px;
    display: flex;
    align-items: center;
    gap: 8px;
    letter-spacing: 0.5px;
}

.form-group label i {
    color: #4073c0;
    font-size: 14px;
    width: 16px;
    text-align: center;
}

.form-input {
    padding: 14px 18px;
    border: 2px solid #e5e7eb;
    border-radius: 10px;
    font-size: 15px;
    font-weight: 500;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    background: #f8fafc;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    width: 100%;
}

.form-input:focus {
    outline: none;
    border-color: #4073c0;
    background: white;
    box-shadow: 0 0 0 4px rgba(64, 115, 192, 0.15), 0 4px 12px rgba(64, 115, 192, 0.1);
    transform: translateY(-1px);
}

.form-input:not(:disabled):not([readonly]) {
    background: white;
    border-color: #cbd5e1;
    color: #1f2937;
}

.form-input:not(:disabled):not([readonly]):hover {
    border-color: #64748b;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    transform: translateY(-1px);
}

.form-input[readonly] {
    background: #f1f5f9;
    color: #64748b;
    cursor: not-allowed;
    border-color: #e2e8f0;
}

.form-input:disabled {
    background: #f1f5f9;
    color: #94a3b8;
    cursor: not-allowed;
    border-color: #e2e8f0;
}

.form-note {
    font-size: 12px;
    color: #6b7280;
    margin-top: 4px;
    font-style: italic;
}

/* Subsections */
.subsection {
    margin-top: 50px;
    padding-top: 35px;
    border-top: 2px solid #e2e8f0;
    position: relative;
}

.subsection::before {
    content: '';
    position: absolute;
    top: -1px;
    left: 0;
    width: 60px;
    height: 2px;
    background: linear-gradient(90deg, #4073c0, #667eea);
}

.subsection h3 {
    font-size: 20px;
    font-weight: 700;
    color: #1f2937;
    margin-bottom: 25px;
    display: flex;
    align-items: center;
    gap: 12px;
    letter-spacing: 0.5px;
}

.subsection h3 i {
    color: #4073c0;
    font-size: 18px;
    width: 20px;
    text-align: center;
}

/* Stress Level Slider */
.stress-level-container {
    display: flex;
    align-items: center;
    gap: 15px;
    margin-bottom: 10px;
}

.stress-slider {
    flex: 1;
    height: 6px;
    border-radius: 3px;
    background: #e5e7eb;
    outline: none;
}

.stress-slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 22px;
    height: 22px;
    border-radius: 50%;
    background: linear-gradient(135deg, #4073c0 0%, #667eea 100%);
    cursor: pointer;
    box-shadow: 0 3px 8px rgba(64, 115, 192, 0.4);
    border: 2px solid white;
    transition: all 0.3s ease;
}

.stress-slider::-webkit-slider-thumb:hover {
    transform: scale(1.1);
    box-shadow: 0 4px 12px rgba(64, 115, 192, 0.6);
}

.stress-slider::-moz-range-thumb {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: #4073c0;
    cursor: pointer;
    border: none;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
}

.stress-value {
    background: #4073c0;
    color: white;
    padding: 8px 12px;
    border-radius: 6px;
    font-weight: 600;
    min-width: 60px;
    text-align: center;
}

.stress-labels {
    display: flex;
    justify-content: space-between;
    font-size: 12px;
    color: #6b7280;
    margin-top: 5px;
}

/* Mood History Section */
.mood-history-container {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 30px;
    margin-top: 20px;
}

.mood-chart-container {
    background: #f8fafc;
    border-radius: 10px;
    padding: 20px;
    height: 300px;
    position: relative;
}

.mood-entries h4 {
    font-size: 16px;
    font-weight: 600;
    color: #1f2937;
    margin-bottom: 15px;
}

.mood-entries-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.mood-entry {
    background: #f8fafc;
    border-radius: 6px;
    padding: 10px 12px;
    border-left: 3px solid #4073c0;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
}

.mood-entry:hover {
    background: #f1f5f9;
    transform: translateX(2px);
}

.mood-entry-main {
    display: flex;
    align-items: center;
    gap: 8px;
    flex: 1;
}

.mood-entry-date {
    font-size: 12px;
    color: #6b7280;
    font-weight: 500;
    white-space: nowrap;
}

.mood-entry-separator {
    color: #9ca3af;
    font-weight: 600;
}

.mood-entry-info {
    display: flex;
    align-items: center;
    gap: 6px;
}

.mood-emoji {
    font-size: 16px;
}

.mood-label {
    font-weight: 500;
    color: #374151;
    font-size: 14px;
}

.mood-method {
    font-size: 10px;
    background: #e5e7eb;
    color: #6b7280;
    padding: 2px 6px;
    border-radius: 3px;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.mood-method.ai {
    background: #dbeafe;
    color: #1e40af;
}

.mood-method.manual {
    background: #d1fae5;
    color: #065f46;
}

/* Animation Classes */
.changing {
    animation: pulse 0.3s ease-in-out;
}

@keyframes pulse {
    0% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.05); opacity: 0.8; }
    100% { transform: scale(1); opacity: 1; }
}

/* Loading State */
.loading {
    position: relative;
    overflow: hidden;
}

.loading::after {
    content: '';
    position: absolute;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.8), transparent);
    animation: loading 1.5s infinite;
}

@keyframes loading {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
}

/* Updated Profile Display Styles - 2-3 Column Grid */
.profile-grid {
    display: grid !important;
    grid-template-columns: repeat(auto-fit, minmax(450px, 1fr)) !important;
    gap: 20px !important;
    margin-bottom: 30px !important;
}

.profile-item {
    display: flex !important;
    align-items: center !important;
    justify-content: space-between !important;
    padding: 16px 20px !important;
    background: white !important;
    border: 1px solid #e5e7eb !important;
    border-radius: 8px !important;
    transition: all 0.2s ease !important;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05) !important;
    position: relative !important;
}

.profile-item:hover {
    background: rgba(64, 115, 192, 0.02) !important;
    border-color: rgba(64, 115, 192, 0.2) !important;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1) !important;
    transform: translateY(-1px) !important;
}

.profile-item::before {
    content: ':' !important;
    position: absolute !important;
    left: 50% !important;
    transform: translateX(-50%) !important;
    color: #6b7280 !important;
    font-weight: 600 !important;
    font-size: 14px !important;
}

.profile-label {
    display: flex !important;
    align-items: center !important;
    gap: 8px !important;
    font-weight: 600 !important;
    color: #374151 !important;
    flex: 1 !important;
    margin-bottom: 0 !important;
    padding-right: 15px !important;
}

.profile-label i {
    color: #4073c0 !important;
    font-size: 16px !important;
    width: 18px !important;
    text-align: center !important;
    flex-shrink: 0 !important;
}

.profile-value {
    font-size: 15px !important;
    font-weight: 500 !important;
    color: #1f2937 !important;
    word-wrap: break-word !important;
    flex: 1 !important;
    padding-left: 15px !important;
    line-height: 1.4 !important;
}

.profile-value:empty::before {
    content: 'Not provided' !important;
    color: #9ca3af !important;
    font-style: italic !important;
    font-weight: 400 !important;
}

/* Responsive Design */
@media (max-width: 1024px) {
    .form-grid {
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 25px;
    }
    
    .profile-grid {
        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)) !important;
        gap: 15px !important;
    }
    
    .mood-history-container {
        grid-template-columns: 1fr;
        gap: 25px;
    }
    
    .mood-chart-container {
        height: 250px;
    }
}

@media (max-width: 768px) {
    .profile-container {
        padding: 20px 0;
    }
    
    .welcome-section {
        padding: 30px 25px;
    }
    
    .welcome-content {
        flex-direction: column;
        text-align: center;
        gap: 25px;
    }
    
    .section-content {
        padding: 30px 25px;
    }
    
    .section-header {
        padding: 20px 25px;
        flex-direction: column;
        gap: 15px;
        align-items: flex-start;
    }
    
    .section-actions {
        align-self: stretch;
        justify-content: center;
    }
    
    .form-grid {
        grid-template-columns: 1fr;
        gap: 25px;
    }
    
    .profile-grid {
        grid-template-columns: 1fr !important;
        gap: 15px !important;
    }
    
    .profile-item::before {
        left: 45% !important;
    }
    
    .stress-level-container {
        flex-direction: column;
        align-items: stretch;
        gap: 15px;
    }
    
    .welcome-text h1 {
        font-size: 28px;
    }
    
    .welcome-section .profile-completion-notice {
        min-width: auto;
        width: 100%;
    }
    
    .welcome-section .completion-content {
        flex-direction: column;
        text-align: center;
        gap: 15px;
    }
}

@media (max-width: 480px) {
    .profile-container {
        padding: 15px 0;
    }
    
    .welcome-section {
        padding: 25px 20px;
        margin-bottom: 25px;
    }
    
    .welcome-content h1 {
        font-size: 24px;
    }
    
    .welcome-content p {
        font-size: 15px;
    }
    
    .section-content {
        padding: 25px 20px;
    }
    
    .section-header {
        padding: 20px;
    }
    
    .section-header h2 {
        font-size: 20px;
    }
    
    .profile-actions {
        gap: 10px;
    }
    
    .profile-actions button {
        padding: 12px 18px;
        font-size: 14px;
        min-width: 120px;
    }
    
    .form-grid {
        gap: 20px;
    }
    
    .subsection {
        margin-top: 35px;
        padding-top: 25px;
    }
    
    .profile-completion-notice {
        padding: 15px;
        margin-bottom: 20px;
    }
    
    .completion-content i {
        font-size: 24px;
    }
    
    .completion-text h3 {
        font-size: 18px;
    }
    
    .progress-circle {
        width: 50px;
        height: 50px;
        font-size: 12px;
    }
}

/* Edit Mode Styles */
.profile-section.edit-mode .profile-display {
    display: none;
}

.profile-section.edit-mode .form-edit {
    display: block;
}

.edit-mode .form-input:not([readonly]):not(:disabled) {
    border-color: #4073c0;
    background: white;
}

.edit-mode .form-input:not([readonly]):not(:disabled):focus {
    box-shadow: 0 0 0 3px rgba(64, 115, 192, 0.15);
}

/* Responsive adjustments for key-value display */
@media (max-width: 768px) {
    .profile-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
        padding: 15px 0;
    }
    
    .profile-label {
        min-width: auto;
        font-size: 13px;
    }
    
    .profile-value {
        text-align: left;
        font-size: 16px;
        color: #4073c0;
        font-weight: 600;
        margin-left: 28px;
    }
}

@media (max-width: 480px) {
    .profile-label {
        font-size: 13px;
    }
    
    .profile-value {
        font-size: 15px;
    }
    
    .profile-item {
        padding: 12px 0;
    }
}

/* Success/Error States */
.form-input.success {
    border-color: #10b981;
    background: #f0fdf4;
}

.form-input.error {
    border-color: #ef4444;
    background: #fef2f2;
}

/* Custom Scrollbar for Textarea */
textarea.form-input {
    resize: vertical;
    min-height: 80px;
}

textarea.form-input::-webkit-scrollbar {
    width: 6px;
}

textarea.form-input::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 3px;
}

textarea.form-input::-webkit-scrollbar-thumb {
    background: #c1c1c1;
    border-radius: 3px;
}

textarea.form-input::-webkit-scrollbar-thumb:hover {
    background: #a8a8a8;
}

    </style>
    </head>
    <body>
        <!-- Add notification container -->
        <div class="notifications-container" id="notifications-container"></div>

        <!-- Header Section -->
        <header>
            <div class="container">
                <div class="logo">
                    <i class="fas fa-brain"></i>
                    <h1>MindSpace</h1>
                </div>
                <nav>
                    <ul class="nav-links">
                        <li><a href="index.html">Home</a></li>
                        <li><a href="dashboard.html">Dashboard</a></li>
                        <li><a href="#" class="active">Profile</a></li>
                    </ul>
                </nav>
                <div style="display: flex; gap: 15px; align-items: center;">
                    <button class="mood-tracker-btn">
                        <i class="fas fa-chart-line"></i> Track Your Mood
                    </button>
                    <div class="user-profile-dropdown">
                        <div class="profile-trigger" id="profile-trigger">
                            <div class="avatar-circle"
                                id="header-avatar">U</div>
                            <span id="header-username">User</span>
                            <i class="fas fa-chevron-down"></i>
                        </div>
                        <div class="dropdown-menu" id="profile-dropdown">
                            <a href="profile.html" class="dropdown-item active">
                                <i class="fas fa-user"></i> Profile
                            </a>
                            <a href="#settings" class="dropdown-item">
                                <i class="fas fa-cog"></i> Settings
                            </a>
                            <div class="dropdown-divider"></div>
                            <a href="#" id="logout-btn" class="dropdown-item">
                                <i class="fas fa-sign-out-alt"></i> Sign Out
                            </a>
                        </div>
                    </div>
                    <div class="hamburger">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                </div>
            </header>

            <!-- Profile Container -->
            <div class="profile-container">
                <div class="container">
                    <!-- Welcome Message -->
                    <div class="welcome-section">
                        <div class="welcome-content">
                            <div class="welcome-text">
                                <h1 id="welcome-message">ðŸ‘‹ Welcome User!</h1>
                                <p>Manage your personal information and track
                                    your wellness journey</p>
                            </div>
                            <!-- Profile Completion Notice -->
                            <div class="profile-completion-notice"
                                id="profile-completion-notice"
                                style="display: none;">
                                <div class="completion-content">
                                    <i class="fas fa-exclamation-triangle"></i>
                                    <div class="completion-text">
                                        <h4>Complete Your Profile</h4>
                                        <p>Get personalized recommendations</p>
                                    </div>
                                    <div class="completion-progress">
                                        <div class="progress-circle">
                                            <span
                                                id="completion-percentage">0%</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Profile Sections -->
                    <div class="profile-sections">

                        <!-- 1. Information Section -->
                        <div class="profile-section">
                            <div class="section-header">
                                <h2><i class="fas fa-user"></i> Personal
                                    Information</h2>
                                <div class="section-actions">
                                    <button class="btn-edit"
                                        id="edit-personal-info">
                                        <i class="fas fa-edit"></i> Edit
                                    </button>
                                    <button class="btn-save"
                                        id="save-personal-info"
                                        style="display: none;">
                                        <i class="fas fa-save"></i> Save
                                    </button>
                                    <button class="btn-cancel"
                                        id="cancel-personal-info"
                                        style="display: none;">
                                        <i class="fas fa-times"></i> Cancel
                                    </button>
                                </div>
                            </div>
                            <div class="section-content">
                                <!-- Profile Display Mode -->
                                <div class="profile-display"
                                    id="personal-display">
                                    <div class="profile-grid">
                                        <div class="profile-item">
                                            <div class="profile-label">
                                                <i class="fas fa-user"></i>
                                                First Name
                                            </div>
                                            <div class="profile-value"
                                                id="display-firstName">Not
                                                provided</div>
                                        </div>
                                        <div class="profile-item">
                                            <div class="profile-label">
                                                <i class="fas fa-user"></i> Last
                                                Name
                                            </div>
                                            <div class="profile-value"
                                                id="display-lastName">Not
                                                provided</div>
                                        </div>
                                        <div class="profile-item">
                                            <div class="profile-label">
                                                <i class="fas fa-envelope"></i>
                                                Email Address
                                            </div>
                                            <div class="profile-value"
                                                id="display-email">Not
                                                provided</div>
                                        </div>
                                        <div class="profile-item">
                                            <div class="profile-label">
                                                <i
                                                    class="fas fa-venus-mars"></i>
                                                Gender
                                            </div>
                                            <div class="profile-value"
                                                id="display-gender">Not
                                                specified</div>
                                        </div>
                                        <div class="profile-item">
                                            <div class="profile-label">
                                                <i
                                                    class="fas fa-calendar-alt"></i>
                                                Date of Birth
                                            </div>
                                            <div class="profile-value"
                                                id="display-dob">Not
                                                provided</div>
                                        </div>
                                        <div class="profile-item">
                                            <div class="profile-label">
                                                <i
                                                    class="fas fa-hourglass-half"></i>
                                                Age
                                            </div>
                                            <div class="profile-value"
                                                id="display-age">Not
                                                calculated</div>
                                        </div>
                                        <div class="profile-item">
                                            <div class="profile-label">
                                                <i class="fas fa-tint"></i>
                                                Blood Group
                                            </div>
                                            <div class="profile-value"
                                                id="display-bloodGroup">Not
                                                specified</div>
                                        </div>
                                        <div class="profile-item">
                                            <div class="profile-label">
                                                <i
                                                    class="fas fa-wheelchair"></i>
                                                Disability
                                            </div>
                                            <div class="profile-value"
                                                id="display-disability">Not
                                                specified</div>
                                        </div>
                                        <div class="profile-item"
                                            id="display-disabilitySpecify"
                                            style="display: none;">
                                            <div class="profile-label">
                                                <i
                                                    class="fas fa-info-circle"></i>
                                                Disability Details
                                            </div>
                                            <div class="profile-value"
                                                id="display-disabilityDetails">-</div>
                                        </div>
                                        <div class="profile-item">
                                            <div class="profile-label">
                                                <i
                                                    class="fas fa-ruler-vertical"></i>
                                                Height
                                            </div>
                                            <div class="profile-value"
                                                id="display-height">Not
                                                provided</div>
                                        </div>
                                        <div class="profile-item">
                                            <div class="profile-label">
                                                <i class="fas fa-weight"></i>
                                                Weight
                                            </div>
                                            <div class="profile-value"
                                                id="display-weight">Not
                                                provided</div>
                                        </div>
                                    </div>

                                    <!-- Address Details -->
                                    <div class="subsection">
                                        <h3><i
                                                class="fas fa-map-marker-alt"></i>
                                            Address Details</h3>
                                        <div class="profile-grid">
                                            <div class="profile-item">
                                                <div class="profile-label">
                                                    <i class="fas fa-city"></i>
                                                    District
                                                </div>
                                                <div class="profile-value"
                                                    id="display-district">Not
                                                    provided</div>
                                            </div>
                                            <div class="profile-item">
                                                <div class="profile-label">
                                                    <i class="fas fa-flag"></i>
                                                    State
                                                </div>
                                                <div class="profile-value"
                                                    id="display-state">Not
                                                    provided</div>
                                            </div>
                                            <div class="profile-item">
                                                <div class="profile-label">
                                                    <i
                                                        class="fas fa-mail-bulk"></i>
                                                    Pincode
                                                </div>
                                                <div class="profile-value"
                                                    id="display-pincode">Not
                                                    provided</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Edit Mode Forms (Hidden by default) -->
                                <div class="form-edit" id="personal-edit"
                                    style="display: none;">
                                    <div class="form-grid">
                                        <div class="form-group">
                                            <label for="firstName"><i
                                                    class="fas fa-user"></i>
                                                First Name</label>
                                            <input type="text" id="firstName"
                                                class="form-input">
                                        </div>
                                        <div class="form-group">
                                            <label for="lastName"><i
                                                    class="fas fa-user"></i>
                                                Last Name</label>
                                            <input type="text" id="lastName"
                                                class="form-input">
                                        </div>
                                        <div class="form-group">
                                            <label for="email"><i
                                                    class="fas fa-envelope"></i>
                                                Email Address</label>
                                            <input type="email" id="email"
                                                class="form-input" readonly>
                                        </div>
                                        <div class="form-group">
                                            <label for="gender"><i
                                                    class="fas fa-venus-mars"></i>
                                                Gender</label>
                                            <select id="gender"
                                                class="form-input">
                                                <option value>Select
                                                    Gender</option>
                                                <option
                                                    value="male">Male</option>
                                                <option
                                                    value="female">Female</option>
                                                <option
                                                    value="other">Other</option>
                                                <option
                                                    value="prefer-not-to-say">Prefer
                                                    not to say</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label for="dob"><i
                                                    class="fas fa-calendar-alt"></i>
                                                Date of Birth</label>
                                            <input type="date" id="dob"
                                                class="form-input">
                                        </div>
                                        <div class="form-group">
                                            <label for="age"><i
                                                    class="fas fa-hourglass-half"></i>
                                                Age</label>
                                            <input type="text" id="age"
                                                class="form-input" readonly
                                                disabled>
                                            <small
                                                class="form-note">Auto-calculated
                                                from DOB</small>
                                        </div>
                                        <div class="form-group">
                                            <label for="bloodGroup"><i
                                                    class="fas fa-tint"></i>
                                                Blood Group</label>
                                            <select id="bloodGroup"
                                                class="form-input">
                                                <option value>Select Blood
                                                    Group</option>
                                                <option value="A+">A+</option>
                                                <option value="A-">A-</option>
                                                <option value="B+">B+</option>
                                                <option value="B-">B-</option>
                                                <option value="AB+">AB+</option>
                                                <option value="AB-">AB-</option>
                                                <option value="O+">O+</option>
                                                <option value="O-">O-</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label for="disability"><i
                                                    class="fas fa-wheelchair"></i>
                                                Disability</label>
                                            <select id="disability"
                                                class="form-input">
                                                <option value>Select
                                                    Option</option>
                                                <option value="no">No</option>
                                                <option value="yes">Yes</option>
                                            </select>
                                        </div>
                                        <div class="form-group"
                                            id="disabilitySpecify"
                                            style="display: none;">
                                            <label for="disabilityDetails"><i
                                                    class="fas fa-info-circle"></i>
                                                Please Specify</label>
                                            <input type="text"
                                                id="disabilityDetails"
                                                class="form-input"
                                                placeholder="Please specify disability">
                                        </div>
                                        <div class="form-group">
                                            <label for="height"><i
                                                    class="fas fa-ruler-vertical"></i>
                                                Height (cm)</label>
                                            <input type="number" id="height"
                                                class="form-input"
                                                placeholder="e.g., 170">
                                        </div>
                                        <div class="form-group">
                                            <label for="weight"><i
                                                    class="fas fa-weight"></i>
                                                Weight (kg)</label>
                                            <input type="number" id="weight"
                                                class="form-input"
                                                placeholder="e.g., 65">
                                        </div>
                                    </div>

                                    <!-- Address Details -->
                                    <div class="subsection">
                                        <h3><i
                                                class="fas fa-map-marker-alt"></i>
                                            Address Details</h3>
                                        <div class="form-grid">
                                            <div class="form-group">
                                                <label for="district"><i
                                                        class="fas fa-city"></i>
                                                    District</label>
                                                <input type="text" id="district"
                                                    class="form-input">
                                            </div>
                                            <div class="form-group">
                                                <label for="state"><i
                                                        class="fas fa-flag"></i>
                                                    State</label>
                                                <input type="text" id="state"
                                                    class="form-input">
                                            </div>
                                            <div class="form-group">
                                                <label for="pincode"><i
                                                        class="fas fa-mail-bulk"></i>
                                                    Pincode</label>
                                                <input type="text" id="pincode"
                                                    class="form-input">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 2. Academic Section -->
                        <div class="profile-section">
                            <div class="section-header">
                                <h2><i class="fas fa-graduation-cap"></i>
                                    Academic Information</h2>
                                <div class="section-actions">
                                    <button class="btn-edit"
                                        id="edit-academic-info">
                                        <i class="fas fa-edit"></i> Edit
                                    </button>
                                    <button class="btn-save"
                                        id="save-academic-info"
                                        style="display: none;">
                                        <i class="fas fa-save"></i> Save
                                    </button>
                                    <button class="btn-cancel"
                                        id="cancel-academic-info"
                                        style="display: none;">
                                        <i class="fas fa-times"></i> Cancel
                                    </button>
                                </div>
                            </div>
                            <div class="section-content">
                                <!-- Profile Display Mode -->
                                <div class="profile-display"
                                    id="academic-display">
                                    <div class="profile-grid">
                                        <div class="profile-item">
                                            <div class="profile-label">
                                                <i
                                                    class="fas fa-user-graduate"></i>
                                                Current Status
                                            </div>
                                            <div class="profile-value"
                                                id="display-currentStatus">Not
                                                specified</div>
                                        </div>
                                        <div class="profile-item">
                                            <div class="profile-label">
                                                <i
                                                    class="fas fa-university"></i>
                                                College/University Name
                                            </div>
                                            <div class="profile-value"
                                                id="display-collegeName">Not
                                                provided</div>
                                        </div>
                                        <div class="profile-item">
                                            <div class="profile-label">
                                                <i class="fas fa-book"></i>
                                                Course Name
                                            </div>
                                            <div class="profile-value"
                                                id="display-courseName">Not
                                                provided</div>
                                        </div>
                                        <div class="profile-item">
                                            <div class="profile-label">
                                                <i class="fas fa-clock"></i>
                                                Course Duration
                                            </div>
                                            <div class="profile-value"
                                                id="display-courseDuration">Not
                                                specified</div>
                                        </div>
                                        <div class="profile-item">
                                            <div class="profile-label">
                                                <i
                                                    class="fas fa-calendar-check"></i>
                                                Current Year
                                            </div>
                                            <div class="profile-value"
                                                id="display-currentYear">Not
                                                specified</div>
                                        </div>
                                        <div class="profile-item">
                                            <div class="profile-label">
                                                <i
                                                    class="fas fa-calendar-plus"></i>
                                                Expected Completion Year
                                            </div>
                                            <div class="profile-value"
                                                id="display-expectedCompletion">Not
                                                specified</div>
                                        </div>
                                        <div class="profile-item">
                                            <div class="profile-label">
                                                <i
                                                    class="fas fa-exclamation-triangle"></i>
                                                Backlogs
                                            </div>
                                            <div class="profile-value"
                                                id="display-backlogs">Not
                                                specified</div>
                                        </div>
                                        <div class="profile-item"
                                            id="display-backlogCount"
                                            style="display: none;">
                                            <div class="profile-label">
                                                <i class="fas fa-hashtag"></i>
                                                Number of Subjects
                                            </div>
                                            <div class="profile-value"
                                                id="display-backlogSubjects">-</div>
                                        </div>
                                        <div class="profile-item">
                                            <div class="profile-label">
                                                <i class="fas fa-laptop"></i>
                                                Mode of Study
                                            </div>
                                            <div class="profile-value"
                                                id="display-studyMode">Not
                                                specified</div>
                                        </div>
                                    </div>

                                    <!-- Current Residence -->
                                    <div class="subsection">
                                        <h3><i class="fas fa-home"></i> Current
                                            Residence</h3>
                                        <div class="profile-grid">
                                            <div class="profile-item">
                                                <div class="profile-label">
                                                    <i class="fas fa-users"></i>
                                                    Living with Parents
                                                </div>
                                                <div class="profile-value"
                                                    id="display-livingWithParents">Not
                                                    specified</div>
                                            </div>
                                            <div class="profile-item"
                                                id="display-livingArrangement"
                                                style="display: none;">
                                                <div class="profile-label">
                                                    <i
                                                        class="fas fa-building"></i>
                                                    Living In
                                                </div>
                                                <div class="profile-value"
                                                    id="display-livingIn">-</div>
                                            </div>
                                            <div class="profile-item">
                                                <div class="profile-label">
                                                    <i class="fas fa-route"></i>
                                                    Distance from College
                                                </div>
                                                <div class="profile-value"
                                                    id="display-collegeDistance">Not
                                                    provided</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Edit Mode Forms (Hidden by default) -->
                                <div class="form-edit" id="academic-edit"
                                    style="display: none;">
                                    <div class="form-grid">
                                        <div class="form-group">
                                            <label for="currentStatus"><i
                                                    class="fas fa-user-graduate"></i>
                                                Current Status</label>
                                            <select id="currentStatus"
                                                class="form-input">
                                                <option value>Select
                                                    Status</option>
                                                <option value="job">Job</option>
                                                <option value="ug">UG
                                                    (Undergraduate)</option>
                                                <option value="pg">PG
                                                    (Postgraduate)</option>
                                                <option value="12th">12th or
                                                    Equivalent</option>
                                                <option value="below-12">Below
                                                    12th</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label for="collegeName"><i
                                                    class="fas fa-university"></i>
                                                College/University Name</label>
                                            <input type="text" id="collegeName"
                                                class="form-input">
                                        </div>
                                        <div class="form-group">
                                            <label for="courseName"><i
                                                    class="fas fa-book"></i>
                                                Course Name</label>
                                            <input type="text" id="courseName"
                                                class="form-input">
                                        </div>
                                        <div class="form-group">
                                            <label for="courseDuration"><i
                                                    class="fas fa-clock"></i>
                                                Course Duration</label>
                                            <select id="courseDuration"
                                                class="form-input">
                                                <option value>Select
                                                    Duration</option>
                                                <option value="2">2
                                                    years</option>
                                                <option value="3">3
                                                    years</option>
                                                <option value="4">4
                                                    years</option>
                                                <option value="5">5
                                                    years</option>
                                                <option value="6">6
                                                    years</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label for="currentYear"><i
                                                    class="fas fa-calendar-check"></i>
                                                Current Year</label>
                                            <input type="number"
                                                id="currentYear"
                                                class="form-input" min="1"
                                                max="6">
                                        </div>
                                        <div class="form-group">
                                            <label for="expectedCompletion"><i
                                                    class="fas fa-calendar-plus"></i>
                                                Expected Course Completion
                                                Year</label>
                                            <input type="number"
                                                id="expectedCompletion"
                                                class="form-input" min="2024"
                                                max="2035">
                                        </div>
                                        <div class="form-group">
                                            <label for="backlogs"><i
                                                    class="fas fa-exclamation-triangle"></i>
                                                Backlogs</label>
                                            <select id="backlogs"
                                                class="form-input">
                                                <option value>Select
                                                    Option</option>
                                                <option value="no">No</option>
                                                <option value="yes">Yes</option>
                                            </select>
                                        </div>
                                        <div class="form-group"
                                            id="backlogCount"
                                            style="display: none;">
                                            <label for="backlogSubjects"><i
                                                    class="fas fa-hashtag"></i>
                                                Number of Subjects</label>
                                            <input type="number"
                                                id="backlogSubjects"
                                                class="form-input" min="0">
                                        </div>
                                        <div class="form-group">
                                            <label for="studyMode"><i
                                                    class="fas fa-laptop"></i>
                                                Mode of Study</label>
                                            <select id="studyMode"
                                                class="form-input">
                                                <option value>Select
                                                    Mode</option>
                                                <option
                                                    value="regular">Regular</option>
                                                <option
                                                    value="online">Online</option>
                                                <option
                                                    value="hybrid">Hybrid/Sometimes</option>
                                            </select>
                                        </div>
                                    </div>

                                    <!-- Current Residence -->
                                    <div class="subsection">
                                        <h3><i class="fas fa-home"></i> Current
                                            Residence</h3>
                                        <div class="form-grid">
                                            <div class="form-group">
                                                <label
                                                    for="livingWithParents"><i
                                                        class="fas fa-users"></i>
                                                    Currently living with
                                                    Parents</label>
                                                <select id="livingWithParents"
                                                    class="form-input">
                                                    <option value>Select
                                                        Option</option>
                                                    <option
                                                        value="yes">Yes</option>
                                                    <option
                                                        value="no">No</option>
                                                </select>
                                            </div>
                                            <div class="form-group"
                                                id="livingArrangement"
                                                style="display: none;">
                                                <label for="livingIn"><i
                                                        class="fas fa-building"></i>
                                                    Living In</label>
                                                <select id="livingIn"
                                                    class="form-input">
                                                    <option value>Select
                                                        Option</option>
                                                    <option
                                                        value="hostel">Hostel</option>
                                                    <option
                                                        value="pg">PG</option>
                                                    <option
                                                        value="rented">Rented</option>
                                                    <option
                                                        value="other">Other</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label for="collegeDistance"><i
                                                        class="fas fa-route"></i>
                                                    Distance from College
                                                    (km)</label>
                                                <input type="number"
                                                    id="collegeDistance"
                                                    class="form-input" min="0"
                                                    step="0.1">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 3. Health & Wellness Section -->
                        <div class="profile-section">
                            <div class="section-header">
                                <h2><i class="fas fa-heart"></i> Health &
                                    Wellness</h2>
                                <div class="section-actions">
                                    <button class="btn-edit"
                                        id="edit-health-info">
                                        <i class="fas fa-edit"></i> Edit
                                    </button>
                                    <button class="btn-save"
                                        id="save-health-info"
                                        style="display: none;">
                                        <i class="fas fa-save"></i> Save
                                    </button>
                                    <button class="btn-cancel"
                                        id="cancel-health-info"
                                        style="display: none;">
                                        <i class="fas fa-times"></i> Cancel
                                    </button>
                                </div>
                            </div>
                            <div class="section-content">
                                <!-- Profile Display Mode -->
                                <div class="profile-display"
                                    id="health-display">
                                    <div class="profile-grid">
                                        <div class="profile-item">
                                            <div class="profile-label">
                                                <i class="fas fa-bed"></i> Sleep
                                                Pattern
                                            </div>
                                            <div class="profile-value"
                                                id="display-sleepPattern">Not
                                                specified</div>
                                        </div>
                                        <div class="profile-item">
                                            <div class="profile-label">
                                                <i class="fas fa-dumbbell"></i>
                                                Exercise Habit
                                            </div>
                                            <div class="profile-value"
                                                id="display-exerciseHabit">Not
                                                specified</div>
                                        </div>
                                        <div class="profile-item"
                                            id="display-exerciseFrequency"
                                            style="display: none;">
                                            <div class="profile-label">
                                                <i
                                                    class="fas fa-calendar-week"></i>
                                                Exercise Frequency
                                            </div>
                                            <div class="profile-value"
                                                id="display-exerciseFreq">-</div>
                                        </div>
                                        <div class="profile-item">
                                            <div class="profile-label">
                                                <i
                                                    class="fas fa-smoking-ban"></i>
                                                Smoking/Drinking Habits
                                            </div>
                                            <div class="profile-value"
                                                id="display-smokingDrinking">Not
                                                specified</div>
                                        </div>
                                        <div class="profile-item">
                                            <div class="profile-label">
                                                <i class="fas fa-brain"></i>
                                                Mental Health Condition
                                            </div>
                                            <div class="profile-value"
                                                id="display-mentalHealthCondition">Not
                                                specified</div>
                                        </div>
                                        <div class="profile-item">
                                            <div class="profile-label">
                                                <i class="fas fa-pills"></i>
                                                Current Medication
                                            </div>
                                            <div class="profile-value"
                                                id="display-currentMedication">None
                                                specified</div>
                                        </div>
                                        <div class="profile-item">
                                            <div class="profile-label">
                                                <i
                                                    class="fas fa-thermometer-half"></i>
                                                Stress Level
                                            </div>
                                            <div class="profile-value"
                                                id="display-stressLevel">5/10</div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Edit Mode Forms (Hidden by default) -->
                                <div class="form-edit" id="health-edit"
                                    style="display: none;">
                                    <div class="form-grid">
                                        <div class="form-group">
                                            <label for="sleepPattern"><i
                                                    class="fas fa-bed"></i>
                                                Sleep Pattern</label>
                                            <select id="sleepPattern"
                                                class="form-input">
                                                <option value>Select Sleep
                                                    Pattern</option>
                                                <option value="<4">&lt; 4
                                                    hours</option>
                                                <option value="4-6">4â€“6
                                                    hours</option>
                                                <option value="6-8">6â€“8
                                                    hours</option>
                                                <option value=">8">&gt; 8
                                                    hours</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label for="exerciseHabit"><i
                                                    class="fas fa-dumbbell"></i>
                                                Exercise Habit</label>
                                            <select id="exerciseHabit"
                                                class="form-input">
                                                <option value>Select
                                                    Option</option>
                                                <option value="no">No</option>
                                                <option value="yes">Yes</option>
                                            </select>
                                        </div>
                                        <div class="form-group"
                                            id="exerciseFrequency"
                                            style="display: none;">
                                            <label for="exerciseFreq"><i
                                                    class="fas fa-calendar-week"></i>
                                                Exercise Frequency</label>
                                            <select id="exerciseFreq"
                                                class="form-input">
                                                <option value>Select
                                                    Frequency</option>
                                                <option
                                                    value="daily">Daily</option>
                                                <option
                                                    value="weekly">Weekly</option>
                                                <option
                                                    value="occasionally">Occasionally</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label for="smokingDrinking"><i
                                                    class="fas fa-smoking-ban"></i>
                                                Smoking/Drinking Habits</label>
                                            <select id="smokingDrinking"
                                                class="form-input">
                                                <option value>Select
                                                    Option</option>
                                                <option value="no">No</option>
                                                <option value="yes">Yes</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label
                                                for="mentalHealthCondition"><i
                                                    class="fas fa-brain"></i>
                                                Existing Mental Health
                                                Condition</label>
                                            <select id="mentalHealthCondition"
                                                class="form-input">
                                                <option value>Select
                                                    Option</option>
                                                <option
                                                    value="anxiety">Anxiety</option>
                                                <option
                                                    value="depression">Depression</option>
                                                <option
                                                    value="none">None</option>
                                                <option
                                                    value="prefer-not-to-say">Prefer
                                                    not to say</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label for="currentMedication"><i
                                                    class="fas fa-pills"></i>
                                                Current Medication
                                                (Optional)</label>
                                            <textarea id="currentMedication"
                                                class="form-input" rows="3"
                                                placeholder="List any current medications..."></textarea>
                                        </div>
                                        <div class="form-group">
                                            <label for="stressLevel"><i
                                                    class="fas fa-thermometer-half"></i>
                                                Stress Level Self-Assessment
                                                (1-10)</label>
                                            <div class="stress-level-container">
                                                <input type="range"
                                                    id="stressLevel"
                                                    class="stress-slider"
                                                    min="1" max="10" value="5">
                                                <div class="stress-value">
                                                    <span
                                                        id="stressValue">5</span>/10
                                                </div>
                                            </div>
                                            <div class="stress-labels">
                                                <span>Low Stress</span>
                                                <span>High Stress</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Mood Tracking History -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Scripts -->
            <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
            <script src="js/config.js"></script>
            <script src="script.js"></script>
            <script>
        // Profile Page JavaScript
document.addEventListener('DOMContentLoaded', function() {
    // Check if user is logged in
    const authToken = localStorage.getItem('authToken');
    if (!authToken) {
        // Redirect to login page if not logged in
        window.location.href = 'index.html';
        return;
    }
    
    // Get user data from localStorage
    const userData = JSON.parse(localStorage.getItem('userData') || '{}');
    
    // Update profile information
    updateProfileInfo(userData);
    
    // Set up authentication header for API requests
    const headers = {
        'Authorization': `Bearer ${authToken}`,
        'Content-Type': 'application/json'
    };
    
    // Profile state management
    let isEditMode = false;
    let originalData = {};
    let moodChart = null;
    
    // API Configuration - use environment config
    const apiConfig = window.ENV_CONFIG || {
        backendApiUrl: 'http://localhost:5001',
        mlServiceUrl: 'http://localhost:5000/predict_emotion'
    };
    
    // Initialize the page
    initializePage();
    
    // Check for recent mood tracking and update the mood button
    async function checkAndUpdateMoodButton() {
        if (!authToken) return;
        
        try {
            const apiUrl = `${apiConfig.backendApiUrl}/api/mood/recent`;
            const response = await fetch(apiUrl, {
                method: 'GET',
                headers
            });
            
            const data = await response.json();
            
            if (data.success && data.isRecent) {
                // User has tracked mood within the last 2 hours
                const moodTrackerBtn = document.querySelector('.mood-tracker-btn');
                if (moodTrackerBtn) {
                    const moodData = data.data;
                    
                    // Emoji map for moods
                    const moodEmojis = {
                        'Angry': 'ðŸ˜ ',
                        'Disgust': 'ðŸ¤¢',
                        'Fear': 'ðŸ˜¨',
                        'Happy': 'ðŸ˜„',
                        'Neutral': 'ðŸ˜',
                        'Sad': 'ðŸ˜¢',
                        'Surprise': 'ðŸ˜²'
                    };
                    
                    const emoji = moodEmojis[moodData.label] || 'ðŸ“Š';
                    
                    moodTrackerBtn.innerHTML = `
                        <span style="font-size: 16px;">${emoji}</span> ${moodData.label}
                    `;
                    
                    // Add a CSS class for styling
                    moodTrackerBtn.classList.add('current-mood');
                }
            }
        } catch (error) {
            console.error('Error checking recent mood:', error);
        }
    }
    
    // Check and update mood button
    checkAndUpdateMoodButton();
    
    // Function to initialize the page
    async function initializePage() {
        // Load user profile data
        await loadUserProfile();
        
        // Check profile completion
        await checkProfileCompletion();
        
        // Set up form interactions
        setupFormInteractions();
        
        // Set up edit mode functionality
        setupEditMode();
        
        // Load mood history chart
        await loadMoodHistory();
        
        // Update stress level display
        updateStressLevelDisplay();
    }
    
    // Function to update profile information in header
    function updateProfileInfo(userData) {
        if (userData) {
            const fullName = `${userData.firstName || ''} ${userData.lastName || ''}`.trim();
            const initials = ((userData.firstName || '').charAt(0) + (userData.lastName || '').charAt(0)).toUpperCase();
            
            // Update header profile dropdown
            document.getElementById('header-username').textContent = userData.firstName || 'User';
            document.getElementById('header-avatar').textContent = initials || 'U';
            
            // Update welcome message
            document.getElementById('welcome-message').textContent = `ðŸ‘‹ Hi, Welcome ${userData.firstName || 'User'}!`;
            
            // Set up dropdown toggle
            setupProfileDropdown();
            
            // Handle logout
            document.getElementById('logout-btn').addEventListener('click', function(e) {
                e.preventDefault();
                
                // Clear authentication data
                localStorage.removeItem('authToken');
                localStorage.removeItem('userData');
                
                // Show success notification
                showSuccess('Logged out successfully!');
                
                // Redirect to home page after short delay
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 1500);
            });
        }
    }
    
    // Function to load user profile data
    async function loadUserProfile() {
        try {
            // First populate with basic user data from localStorage
            populateBasicInfo(userData);
            
            // Then try to load extended profile data from backend
            const apiUrl = `${apiConfig.backendApiUrl}/api/user/profile`;
            const response = await fetch(apiUrl, {
                method: 'GET',
                headers
            });
            
            if (response.ok) {
                const data = await response.json();
                if (data.success && data.profile) {
                    populateProfileData(data.profile);
                    originalData = { ...data.profile };
                }
            } else {
                console.warn('Could not load extended profile data');
            }
        } catch (error) {
            console.error('Error loading profile:', error);
            // Continue with basic data from localStorage
        }
    }
    
    // Function to populate basic user info
    function populateBasicInfo(data) {
        document.getElementById('firstName').value = data.firstName || '';
        document.getElementById('lastName').value = data.lastName || '';
        document.getElementById('email').value = data.email || '';
        
        // Calculate and display age if DOB is available
        if (data.dob) {
            document.getElementById('dob').value = data.dob;
            calculateAndSetAge(data.dob);
        }
    }
    
    // Function to populate all profile data
    function populateProfileData(profile) {
        // Personal Information - Display
        document.getElementById('display-firstName').textContent = profile.firstName || 'Not provided';
        document.getElementById('display-lastName').textContent = profile.lastName || 'Not provided';
        document.getElementById('display-email').textContent = profile.email || 'Not provided';
        document.getElementById('display-gender').textContent = formatGender(profile.gender) || 'Not specified';
        document.getElementById('display-dob').textContent = formatDate(profile.dob) || 'Not provided';
        document.getElementById('display-age').textContent = calculateAge(profile.dob) || 'Not calculated';
        document.getElementById('display-bloodGroup').textContent = profile.bloodGroup || 'Not specified';
        document.getElementById('display-disability').textContent = formatYesNo(profile.disability) || 'Not specified';
        document.getElementById('display-height').textContent = profile.height ? `${profile.height} cm` : 'Not provided';
        document.getElementById('display-weight').textContent = profile.weight ? `${profile.weight} kg` : 'Not provided';
        
        // Disability details
        if (profile.disability === 'yes' && profile.disabilityDetails) {
            document.getElementById('display-disabilitySpecify').style.display = 'block';
            document.getElementById('display-disabilityDetails').textContent = profile.disabilityDetails;
        }
        
        // Address Details - Display
        document.getElementById('display-district').textContent = profile.district || 'Not provided';
        document.getElementById('display-state').textContent = profile.state || 'Not provided';
        document.getElementById('display-pincode').textContent = profile.pincode || 'Not provided';
        
        // Academic Information - Display
        document.getElementById('display-currentStatus').textContent = formatCurrentStatus(profile.currentStatus) || 'Not specified';
        document.getElementById('display-collegeName').textContent = profile.collegeName || 'Not provided';
        document.getElementById('display-courseName').textContent = profile.courseName || 'Not provided';
        document.getElementById('display-courseDuration').textContent = profile.courseDuration ? `${profile.courseDuration} years` : 'Not specified';
        document.getElementById('display-currentYear').textContent = profile.currentYear || 'Not specified';
        document.getElementById('display-expectedCompletion').textContent = profile.expectedCompletion || 'Not specified';
        document.getElementById('display-backlogs').textContent = formatYesNo(profile.backlogs) || 'Not specified';
        document.getElementById('display-studyMode').textContent = formatStudyMode(profile.studyMode) || 'Not specified';
        
        // Backlog details
        if (profile.backlogs === 'yes' && profile.backlogSubjects) {
            document.getElementById('display-backlogCount').style.display = 'block';
            document.getElementById('display-backlogSubjects').textContent = profile.backlogSubjects;
        }
        
        // Residence - Display
        document.getElementById('display-livingWithParents').textContent = formatYesNo(profile.livingWithParents) || 'Not specified';
        document.getElementById('display-collegeDistance').textContent = profile.collegeDistance ? `${profile.collegeDistance} km` : 'Not provided';
        
        // Living arrangement
        if (profile.livingWithParents === 'no' && profile.livingIn) {
            document.getElementById('display-livingArrangement').style.display = 'block';
            document.getElementById('display-livingIn').textContent = formatLivingIn(profile.livingIn);
        }
        
        // Health & Wellness - Display
        document.getElementById('display-sleepPattern').textContent = formatSleepPattern(profile.sleepPattern) || 'Not specified';
        document.getElementById('display-exerciseHabit').textContent = formatYesNo(profile.exerciseHabit) || 'Not specified';
        document.getElementById('display-smokingDrinking').textContent = formatYesNo(profile.smokingDrinking) || 'Not specified';
        document.getElementById('display-mentalHealthCondition').textContent = formatMentalHealth(profile.mentalHealthCondition) || 'Not specified';
        document.getElementById('display-currentMedication').textContent = profile.currentMedication || 'None specified';
        document.getElementById('display-stressLevel').textContent = `${profile.stressLevel || 5}/10`;
        
        // Exercise frequency
        if (profile.exerciseHabit === 'yes' && profile.exerciseFreq) {
            document.getElementById('display-exerciseFrequency').style.display = 'block';
            document.getElementById('display-exerciseFreq').textContent = formatExerciseFreq(profile.exerciseFreq);
        }

        // Personal Information - Form
        if (profile.firstName) document.getElementById('firstName').value = profile.firstName;
        if (profile.lastName) document.getElementById('lastName').value = profile.lastName;
        if (profile.email) document.getElementById('email').value = profile.email;
        if (profile.gender) document.getElementById('gender').value = profile.gender;
        if (profile.dob) {
            document.getElementById('dob').value = profile.dob.split('T')[0]; // Format for date input
            calculateAndSetAge(profile.dob);
        }
        if (profile.bloodGroup) document.getElementById('bloodGroup').value = profile.bloodGroup;
        if (profile.disability) {
            document.getElementById('disability').value = profile.disability;
            toggleDisabilityDetails(profile.disability === 'yes');
            if (profile.disabilityDetails) document.getElementById('disabilityDetails').value = profile.disabilityDetails;
        }
        if (profile.height) document.getElementById('height').value = profile.height;
        if (profile.weight) document.getElementById('weight').value = profile.weight;
        
        // Address Details
        if (profile.district) document.getElementById('district').value = profile.district;
        if (profile.state) document.getElementById('state').value = profile.state;
        if (profile.pincode) document.getElementById('pincode').value = profile.pincode;
        
        // Academic Information
        if (profile.currentStatus) document.getElementById('currentStatus').value = profile.currentStatus;
        if (profile.collegeName) document.getElementById('collegeName').value = profile.collegeName;
        if (profile.courseName) document.getElementById('courseName').value = profile.courseName;
        if (profile.courseDuration) document.getElementById('courseDuration').value = profile.courseDuration;
        if (profile.currentYear) document.getElementById('currentYear').value = profile.currentYear;
        if (profile.expectedCompletion) document.getElementById('expectedCompletion').value = profile.expectedCompletion;
        if (profile.backlogs) {
            document.getElementById('backlogs').value = profile.backlogs;
            toggleBacklogCount(profile.backlogs === 'yes');
            if (profile.backlogSubjects) document.getElementById('backlogSubjects').value = profile.backlogSubjects;
        }
        if (profile.studyMode) document.getElementById('studyMode').value = profile.studyMode;
        
        // Current Residence
        if (profile.livingWithParents) {
            document.getElementById('livingWithParents').value = profile.livingWithParents;
            toggleLivingArrangement(profile.livingWithParents === 'no');
            if (profile.livingIn) document.getElementById('livingIn').value = profile.livingIn;
        }
        if (profile.collegeDistance) document.getElementById('collegeDistance').value = profile.collegeDistance;
        
        // Health & Wellness
        if (profile.sleepPattern) document.getElementById('sleepPattern').value = profile.sleepPattern;
        if (profile.exerciseHabit) {
            document.getElementById('exerciseHabit').value = profile.exerciseHabit;
            toggleExerciseFrequency(profile.exerciseHabit === 'yes');
            if (profile.exerciseFreq) document.getElementById('exerciseFreq').value = profile.exerciseFreq;
        }
        if (profile.smokingDrinking) document.getElementById('smokingDrinking').value = profile.smokingDrinking;
        if (profile.mentalHealthCondition) document.getElementById('mentalHealthCondition').value = profile.mentalHealthCondition;
        if (profile.currentMedication) document.getElementById('currentMedication').value = profile.currentMedication;
        if (profile.stressLevel) {
            document.getElementById('stressLevel').value = profile.stressLevel;
            document.getElementById('stressValue').textContent = profile.stressLevel;
        }
    }
    
    // Function to set up form interactions
    function setupFormInteractions() {
        // DOB change handler
        document.getElementById('dob').addEventListener('change', function() {
            if (this.value) {
                calculateAndSetAge(this.value);
            }
        });
        
        // Disability dropdown change handler
        document.getElementById('disability').addEventListener('change', function() {
            toggleDisabilityDetails(this.value === 'yes');
        });
        
        // Backlogs dropdown change handler
        document.getElementById('backlogs').addEventListener('change', function() {
            toggleBacklogCount(this.value === 'yes');
        });
        
        // Living with parents change handler
        document.getElementById('livingWithParents').addEventListener('change', function() {
            toggleLivingArrangement(this.value === 'no');
        });
        
        // Exercise habit change handler
        document.getElementById('exerciseHabit').addEventListener('change', function() {
            toggleExerciseFrequency(this.value === 'yes');
        });
        
        // Stress level slider change handler
        document.getElementById('stressLevel').addEventListener('input', function() {
            document.getElementById('stressValue').textContent = this.value;
        });
    }
    
    // Function to set up edit mode functionality
    function setupEditMode() {
        // Personal Information Section
        setupSectionEdit('personal-info', 'personal');
        
        // Academic Information Section
        setupSectionEdit('academic-info', 'academic');
        
        // Health & Wellness Section
        setupSectionEdit('health-info', 'health');
    }
    
    // Function to set up individual section editing
    function setupSectionEdit(sectionName, sectionType) {
        const editButton = document.getElementById(`edit-${sectionName}`);
        const saveButton = document.getElementById(`save-${sectionName}`);
        const cancelButton = document.getElementById(`cancel-${sectionName}`);
        
        if (!editButton || !saveButton || !cancelButton) return;
        
        let originalSectionData = {};
        
        editButton.addEventListener('click', () => {
            // Store original data for this section
            originalSectionData = getCurrentSectionData(sectionType);
            
            // Enter edit mode for this section
            enterSectionEditMode(sectionName, sectionType);
        });
        
        saveButton.addEventListener('click', () => {
            saveSectionProfile(sectionName, sectionType);
        });
        
        cancelButton.addEventListener('click', () => {
            // Restore original data
            populateSectionData(sectionType, originalSectionData);
            exitSectionEditMode(sectionName, sectionType);
            showInfo(`${getSectionDisplayName(sectionType)} changes cancelled.`);
        });
    }
    
    // Function to enter edit mode
    function enterEditMode() {
        isEditMode = true;
        document.body.classList.add('edit-mode');
        
        // Store original data for cancel functionality
        originalData = getCurrentFormData();
        
        // Enable form inputs
        enableFormInputs();
        
        // Show/hide buttons
        document.getElementById('edit-mode-toggle').style.display = 'none';
        document.getElementById('save-profile').style.display = 'flex';
        document.getElementById('cancel-edit').style.display = 'flex';
        
        showInfo('Edit mode enabled. You can now modify your profile information.');
    }
    
    // Function to save profile
    async function saveProfile() {
        try {
            // Show loading state
            const saveButton = document.getElementById('save-profile');
            const originalText = saveButton.innerHTML;
            saveButton.disabled = true;
            saveButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
            
            // Get current form data
            const profileData = getCurrentFormData();
            
            // Clean up data - remove empty values
            Object.keys(profileData).forEach(key => {
                if (profileData[key] === '' || profileData[key] === null || profileData[key] === undefined) {
                    delete profileData[key];
                }
            });
            
            // Convert numeric strings to numbers where appropriate
            if (profileData.height) profileData.height = Number(profileData.height);
            if (profileData.weight) profileData.weight = Number(profileData.weight);
            if (profileData.currentYear) profileData.currentYear = Number(profileData.currentYear);
            if (profileData.expectedCompletion) profileData.expectedCompletion = Number(profileData.expectedCompletion);
            if (profileData.backlogSubjects) profileData.backlogSubjects = Number(profileData.backlogSubjects);
            if (profileData.collegeDistance) profileData.collegeDistance = Number(profileData.collegeDistance);
            if (profileData.courseDuration) profileData.courseDuration = Number(profileData.courseDuration);
            if (profileData.stressLevel) profileData.stressLevel = Number(profileData.stressLevel);
            
            console.log('Sending profile data:', profileData);
            
            // Send update request to backend
            const apiUrl = `${apiConfig.backendApiUrl}/api/user/profile`;
            const response = await fetch(apiUrl, {
                method: 'PUT',
                headers,
                body: JSON.stringify(profileData)
            });
            
            const responseText = await response.text();
            console.log('Server response:', responseText);
            
            if (response.ok) {
                const data = JSON.parse(responseText);
                if (data.success) {
                    showSuccess('Profile updated successfully!');
                    
                    // Reload profile data to reflect changes
                    await loadUserProfile();
                    exitEditMode();
                    
                    // Update localStorage with new data if user data was updated
                    if (data.userData) {
                        const updatedUserData = { ...userData, ...data.userData };
                        localStorage.setItem('userData', JSON.stringify(updatedUserData));
                        updateProfileInfo(updatedUserData);
                    }
                } else {
                    throw new Error(data.message || 'Failed to update profile');
                }
            } else {
                let errorMessage = 'Failed to update profile';
                try {
                    const errorData = JSON.parse(responseText);
                    errorMessage = errorData.message || errorData.error || errorMessage;
                    if (errorData.errors && Array.isArray(errorData.errors)) {
                        errorMessage += ': ' + errorData.errors.join(', ');
                    }
                } catch (e) {
                    errorMessage = `Server error: ${response.status} - ${responseText}`;
                }
                throw new Error(errorMessage);
            }
        } catch (error) {
            console.error('Error saving profile:', error);
            showError('Failed to save profile: ' + error.message);
        } finally {
            // Reset button state
            const saveButton = document.getElementById('save-profile');
            saveButton.disabled = false;
            saveButton.innerHTML = '<i class="fas fa-save"></i> Save Changes';
        }
    }
    
    // Function to cancel edit
    function cancelEdit() {
        // Restore original data
        populateProfileData(originalData);
        exitEditMode();
        showInfo('Changes cancelled. Profile restored to original state.');
    }
    
    // Function to exit edit mode
    function exitEditMode() {
        isEditMode = false;
        document.body.classList.remove('edit-mode');
        
        // Disable form inputs
        disableFormInputs();
        
        // Show/hide buttons
        const editToggle = document.getElementById('edit-mode-toggle');
        const saveProfile = document.getElementById('save-profile');
        const cancelEdit = document.getElementById('cancel-edit');
        
        if (editToggle) editToggle.style.display = 'flex';
        if (saveProfile) saveProfile.style.display = 'none';
        if (cancelEdit) cancelEdit.style.display = 'none';
    }
    
    // Function to enter section edit mode
    function enterSectionEditMode(sectionName, sectionType) {
        const displayDiv = document.getElementById(`${sectionType}-display`);
        const editDiv = document.getElementById(`${sectionType}-edit`);
        const editButton = document.getElementById(`edit-${sectionName}`);
        const saveButton = document.getElementById(`save-${sectionName}`);
        const cancelButton = document.getElementById(`cancel-${sectionName}`);
        
        // Toggle display/edit views
        if (displayDiv) displayDiv.style.display = 'none';
        if (editDiv) editDiv.style.display = 'block';
        
        // Toggle buttons
        if (editButton) editButton.style.display = 'none';
        if (saveButton) saveButton.style.display = 'flex';
        if (cancelButton) cancelButton.style.display = 'flex';
        
        // Enable inputs for this section only
        enableSectionInputs(sectionType);
        
        showInfo(`${getSectionDisplayName(sectionType)} edit mode enabled.`);
    }
    
    // Function to exit section edit mode
    function exitSectionEditMode(sectionName, sectionType) {
        const displayDiv = document.getElementById(`${sectionType}-display`);
        const editDiv = document.getElementById(`${sectionType}-edit`);
        const editButton = document.getElementById(`edit-${sectionName}`);
        const saveButton = document.getElementById(`save-${sectionName}`);
        const cancelButton = document.getElementById(`cancel-${sectionName}`);
        
        // Toggle display/edit views
        if (displayDiv) displayDiv.style.display = 'block';
        if (editDiv) editDiv.style.display = 'none';
        
        // Toggle buttons
        if (editButton) editButton.style.display = 'flex';
        if (saveButton) saveButton.style.display = 'none';
        if (cancelButton) cancelButton.style.display = 'none';
        
        // Disable inputs for this section
        disableSectionInputs(sectionType);
    }
    
    // Function to enable inputs for a specific section
    function enableSectionInputs(sectionType) {
        const editDiv = document.getElementById(`${sectionType}-edit`);
        if (!editDiv) return;
        
        const inputs = editDiv.querySelectorAll('.form-input');
        inputs.forEach(input => {
            if (input.id !== 'email' && input.id !== 'age') { // Keep email and age readonly
                input.removeAttribute('readonly');
                input.removeAttribute('disabled');
            }
        });
    }
    
    // Function to disable inputs for a specific section
    function disableSectionInputs(sectionType) {
        const editDiv = document.getElementById(`${sectionType}-edit`);
        if (!editDiv) return;
        
        const inputs = editDiv.querySelectorAll('.form-input');
        inputs.forEach(input => {
            if (input.tagName === 'SELECT') {
                input.disabled = true;
            } else {
                input.readOnly = true;
            }
        });
    }
    
    // Function to get current section data
    function getCurrentSectionData(sectionType) {
        const data = {};
        
        if (sectionType === 'personal') {
            data.firstName = document.getElementById('firstName').value;
            data.lastName = document.getElementById('lastName').value;
            data.email = document.getElementById('email').value;
            data.gender = document.getElementById('gender').value;
            data.dob = document.getElementById('dob').value;
            data.bloodGroup = document.getElementById('bloodGroup').value;
            data.disability = document.getElementById('disability').value;
            data.disabilityDetails = document.getElementById('disabilityDetails').value;
            data.height = document.getElementById('height').value;
            data.weight = document.getElementById('weight').value;
            data.district = document.getElementById('district').value;
            data.state = document.getElementById('state').value;
            data.pincode = document.getElementById('pincode').value;
        } else if (sectionType === 'academic') {
            data.currentStatus = document.getElementById('currentStatus').value;
            data.collegeName = document.getElementById('collegeName').value;
            data.courseName = document.getElementById('courseName').value;
            data.courseDuration = document.getElementById('courseDuration').value;
            data.currentYear = document.getElementById('currentYear').value;
            data.expectedCompletion = document.getElementById('expectedCompletion').value;
            data.backlogs = document.getElementById('backlogs').value;
            data.backlogSubjects = document.getElementById('backlogSubjects').value;
            data.studyMode = document.getElementById('studyMode').value;
            data.livingWithParents = document.getElementById('livingWithParents').value;
            data.livingIn = document.getElementById('livingIn').value;
            data.collegeDistance = document.getElementById('collegeDistance').value;
        } else if (sectionType === 'health') {
            data.sleepPattern = document.getElementById('sleepPattern').value;
            data.exerciseHabit = document.getElementById('exerciseHabit').value;
            data.exerciseFreq = document.getElementById('exerciseFreq').value;
            data.smokingDrinking = document.getElementById('smokingDrinking').value;
            data.mentalHealthCondition = document.getElementById('mentalHealthCondition').value;
            data.currentMedication = document.getElementById('currentMedication').value;
            data.stressLevel = document.getElementById('stressLevel').value;
        }
        
        return data;
    }
    
    // Function to populate section data
    function populateSectionData(sectionType, data) {
        if (sectionType === 'personal') {
            if (data.firstName !== undefined) document.getElementById('firstName').value = data.firstName || '';
            if (data.lastName !== undefined) document.getElementById('lastName').value = data.lastName || '';
            if (data.email !== undefined) document.getElementById('email').value = data.email || '';
            if (data.gender !== undefined) document.getElementById('gender').value = data.gender || '';
            if (data.dob !== undefined) {
                document.getElementById('dob').value = data.dob || '';
                if (data.dob) calculateAndSetAge(data.dob);
            }
            if (data.bloodGroup !== undefined) document.getElementById('bloodGroup').value = data.bloodGroup || '';
            if (data.disability !== undefined) {
                document.getElementById('disability').value = data.disability || '';
                toggleDisabilityDetails(data.disability === 'yes');
            }
            if (data.disabilityDetails !== undefined) document.getElementById('disabilityDetails').value = data.disabilityDetails || '';
            if (data.height !== undefined) document.getElementById('height').value = data.height || '';
            if (data.weight !== undefined) document.getElementById('weight').value = data.weight || '';
            if (data.district !== undefined) document.getElementById('district').value = data.district || '';
            if (data.state !== undefined) document.getElementById('state').value = data.state || '';
            if (data.pincode !== undefined) document.getElementById('pincode').value = data.pincode || '';
        } else if (sectionType === 'academic') {
            if (data.currentStatus !== undefined) document.getElementById('currentStatus').value = data.currentStatus || '';
            if (data.collegeName !== undefined) document.getElementById('collegeName').value = data.collegeName || '';
            if (data.courseName !== undefined) document.getElementById('courseName').value = data.courseName || '';
            if (data.courseDuration !== undefined) document.getElementById('courseDuration').value = data.courseDuration || '';
            if (data.currentYear !== undefined) document.getElementById('currentYear').value = data.currentYear || '';
            if (data.expectedCompletion !== undefined) document.getElementById('expectedCompletion').value = data.expectedCompletion || '';
            if (data.backlogs !== undefined) {
                document.getElementById('backlogs').value = data.backlogs || '';
                toggleBacklogCount(data.backlogs === 'yes');
            }
            if (data.backlogSubjects !== undefined) document.getElementById('backlogSubjects').value = data.backlogSubjects || '';
            if (data.studyMode !== undefined) document.getElementById('studyMode').value = data.studyMode || '';
            if (data.livingWithParents !== undefined) {
                document.getElementById('livingWithParents').value = data.livingWithParents || '';
                toggleLivingArrangement(data.livingWithParents === 'no');
            }
            if (data.livingIn !== undefined) document.getElementById('livingIn').value = data.livingIn || '';
            if (data.collegeDistance !== undefined) document.getElementById('collegeDistance').value = data.collegeDistance || '';
        } else if (sectionType === 'health') {
            if (data.sleepPattern !== undefined) document.getElementById('sleepPattern').value = data.sleepPattern || '';
            if (data.exerciseHabit !== undefined) {
                document.getElementById('exerciseHabit').value = data.exerciseHabit || '';
                toggleExerciseFrequency(data.exerciseHabit === 'yes');
            }
            if (data.exerciseFreq !== undefined) document.getElementById('exerciseFreq').value = data.exerciseFreq || '';
            if (data.smokingDrinking !== undefined) document.getElementById('smokingDrinking').value = data.smokingDrinking || '';
            if (data.mentalHealthCondition !== undefined) document.getElementById('mentalHealthCondition').value = data.mentalHealthCondition || '';
            if (data.currentMedication !== undefined) document.getElementById('currentMedication').value = data.currentMedication || '';
            if (data.stressLevel !== undefined) {
                document.getElementById('stressLevel').value = data.stressLevel || 5;
                document.getElementById('stressValue').textContent = data.stressLevel || 5;
            }
        }
    }
    
    // Function to save section profile
    async function saveSectionProfile(sectionName, sectionType) {
        try {
            // Show loading state
            const saveButton = document.getElementById(`save-${sectionName}`);
            const originalText = saveButton.innerHTML;
            saveButton.disabled = true;
            saveButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
            
            // Get current section data
            const sectionData = getCurrentSectionData(sectionType);
            
            // Clean up data - remove empty values
            Object.keys(sectionData).forEach(key => {
                if (sectionData[key] === '' || sectionData[key] === null || sectionData[key] === undefined) {
                    delete sectionData[key];
                }
            });
            
            // Convert numeric strings to numbers where appropriate
            const numericFields = ['height', 'weight', 'currentYear', 'expectedCompletion', 'backlogSubjects', 'collegeDistance', 'courseDuration', 'stressLevel'];
            numericFields.forEach(field => {
                if (sectionData[field]) {
                    sectionData[field] = Number(sectionData[field]);
                }
            });
            
            console.log('Sending section data:', sectionData);
            
            // Send update request to backend
            const apiUrl = `${apiConfig.backendApiUrl}/api/user/profile`;
            const response = await fetch(apiUrl, {
                method: 'PUT',
                headers,
                body: JSON.stringify(sectionData)
            });
            
            const responseText = await response.text();
            console.log('Server response:', responseText);
            
            if (response.ok) {
                const data = JSON.parse(responseText);
                if (data.success) {
                    showSuccess(`${getSectionDisplayName(sectionType)} updated successfully!`);
                    
                    // Reload profile data to reflect changes
                    await loadUserProfile();
                    exitSectionEditMode(sectionName, sectionType);
                    
                    // Update localStorage with new data if user data was updated
                    if (data.userData) {
                        const updatedUserData = { ...userData, ...data.userData };
                        localStorage.setItem('userData', JSON.stringify(updatedUserData));
                        updateProfileInfo(updatedUserData);
                    }
                } else {
                    throw new Error(data.message || 'Failed to update profile');
                }
            } else {
                let errorMessage = 'Failed to update profile';
                try {
                    const errorData = JSON.parse(responseText);
                    errorMessage = errorData.message || errorData.error || errorMessage;
                    if (errorData.errors && Array.isArray(errorData.errors)) {
                        errorMessage += ': ' + errorData.errors.join(', ');
                    }
                } catch (e) {
                    errorMessage = `Server error: ${response.status} - ${responseText}`;
                }
                throw new Error(errorMessage);
            }
        } catch (error) {
            console.error('Error saving section:', error);
            showError(`Failed to save ${getSectionDisplayName(sectionType)}: ` + error.message);
        } finally {
            // Reset button state
            const saveButton = document.getElementById(`save-${sectionName}`);
            saveButton.disabled = false;
            saveButton.innerHTML = '<i class="fas fa-save"></i> Save';
        }
    }
    
    // Function to get section display name
    function getSectionDisplayName(sectionType) {
        const names = {
            'personal': 'Personal Information',
            'academic': 'Academic Information',
            'health': 'Health & Wellness'
        };
        return names[sectionType] || sectionType;
    }
    
    // Function to enable form inputs
    function enableFormInputs() {
        const inputs = document.querySelectorAll('.form-input');
        inputs.forEach(input => {
            if (input.id !== 'email' && input.id !== 'age') { // Keep email and age readonly
                input.removeAttribute('readonly');
                input.removeAttribute('disabled');
            }
        });
    }
    
    // Function to disable form inputs
    function disableFormInputs() {
        const inputs = document.querySelectorAll('.form-input');
        inputs.forEach(input => {
            if (input.tagName === 'SELECT') {
                input.disabled = true;
            } else {
                input.readOnly = true;
            }
        });
    }
    
    // Function to get current form data
    function getCurrentFormData() {
        return {
            firstName: document.getElementById('firstName').value,
            lastName: document.getElementById('lastName').value,
            email: document.getElementById('email').value,
            gender: document.getElementById('gender').value,
            dob: document.getElementById('dob').value,
            bloodGroup: document.getElementById('bloodGroup').value,
            disability: document.getElementById('disability').value,
            disabilityDetails: document.getElementById('disabilityDetails').value,
            height: document.getElementById('height').value,
            weight: document.getElementById('weight').value,
            district: document.getElementById('district').value,
            state: document.getElementById('state').value,
            pincode: document.getElementById('pincode').value,
            currentStatus: document.getElementById('currentStatus').value,
            collegeName: document.getElementById('collegeName').value,
            courseName: document.getElementById('courseName').value,
            courseDuration: document.getElementById('courseDuration').value,
            currentYear: document.getElementById('currentYear').value,
            expectedCompletion: document.getElementById('expectedCompletion').value,
            backlogs: document.getElementById('backlogs').value,
            backlogSubjects: document.getElementById('backlogSubjects').value,
            studyMode: document.getElementById('studyMode').value,
            livingWithParents: document.getElementById('livingWithParents').value,
            livingIn: document.getElementById('livingIn').value,
            collegeDistance: document.getElementById('collegeDistance').value,
            sleepPattern: document.getElementById('sleepPattern').value,
            exerciseHabit: document.getElementById('exerciseHabit').value,
            exerciseFreq: document.getElementById('exerciseFreq').value,
            smokingDrinking: document.getElementById('smokingDrinking').value,
            mentalHealthCondition: document.getElementById('mentalHealthCondition').value,
            currentMedication: document.getElementById('currentMedication').value,
            stressLevel: document.getElementById('stressLevel').value
        };
    }
    
    // Utility functions for form interactions
    function calculateAndSetAge(dobString) {
        const dob = new Date(dobString);
        const today = new Date();
        let age = today.getFullYear() - dob.getFullYear();
        const monthDiff = today.getMonth() - dob.getMonth();
        
        if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < dob.getDate())) {
            age--;
        }
        
        document.getElementById('age').value = age > 0 ? age : '';
    }
    
    function toggleDisabilityDetails(show) {
        const detailsGroup = document.getElementById('disabilitySpecify');
        detailsGroup.style.display = show ? 'flex' : 'none';
    }
    
    function toggleBacklogCount(show) {
        const backlogGroup = document.getElementById('backlogCount');
        backlogGroup.style.display = show ? 'flex' : 'none';
    }
    
    function toggleLivingArrangement(show) {
        const livingGroup = document.getElementById('livingArrangement');
        livingGroup.style.display = show ? 'flex' : 'none';
    }
    
    function toggleExerciseFrequency(show) {
        const exerciseFreqGroup = document.getElementById('exerciseFrequency');
        exerciseFreqGroup.style.display = show ? 'flex' : 'none';
    }
    
    function updateStressLevelDisplay() {
        const stressSlider = document.getElementById('stressLevel');
        const stressValue = document.getElementById('stressValue');
        
        stressSlider.addEventListener('input', function() {
            stressValue.textContent = this.value;
        });
    }
    
    // Helper functions for formatting display values
    function formatGender(gender) {
        const genderMap = {
            'male': 'Male',
            'female': 'Female',
            'other': 'Other',
            'prefer-not-to-say': 'Prefer not to say'
        };
        return genderMap[gender] || gender;
    }
    
    function formatDate(dateString) {
        if (!dateString) return null;
        const date = new Date(dateString);
        return date.toLocaleDateString(undefined, { 
            year: 'numeric', 
            month: 'long', 
            day: 'numeric' 
        });
    }
    
    function calculateAge(dobString) {
        if (!dobString) return null;
        const dob = new Date(dobString);
        const today = new Date();
        let age = today.getFullYear() - dob.getFullYear();
        const monthDiff = today.getMonth() - dob.getMonth();
        
        if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < dob.getDate())) {
            age--;
        }
        
        return age > 0 ? `${age} years old` : null;
    }
    
    function formatYesNo(value) {
        return value === 'yes' ? 'Yes' : value === 'no' ? 'No' : value;
    }
    
    function formatCurrentStatus(status) {
        const statusMap = {
            'job': 'Job',
            'ug': 'UG (Undergraduate)',
            'pg': 'PG (Postgraduate)',
            '12th': '12th or Equivalent',
            'below-12': 'Below 12th'
        };
        return statusMap[status] || status;
    }
    
    function formatStudyMode(mode) {
        const modeMap = {
            'regular': 'Regular',
            'online': 'Online',
            'hybrid': 'Hybrid/Sometimes'
        };
        return modeMap[mode] || mode;
    }
    
    function formatLivingIn(living) {
        const livingMap = {
            'hostel': 'Hostel',
            'pg': 'PG',
            'rented': 'Rented',
            'other': 'Other'
        };
        return livingMap[living] || living;
    }
    
    function formatSleepPattern(pattern) {
        const patternMap = {
            '<4': '< 4 hours',
            '4-6': '4â€“6 hours',
            '6-8': '6â€“8 hours',
            '>8': '> 8 hours'
        };
        return patternMap[pattern] || pattern;
    }
    
    function formatMentalHealth(condition) {
        const conditionMap = {
            'anxiety': 'Anxiety',
            'depression': 'Depression',
            'none': 'None',
            'prefer-not-to-say': 'Prefer not to say'
        };
        return conditionMap[condition] || condition;
    }
    
    function formatExerciseFreq(freq) {
        const freqMap = {
            'daily': 'Daily',
            'weekly': 'Weekly',
            'occasionally': 'Occasionally'
        };
        return freqMap[freq] || freq;
    }
    
    async function loadMoodHistory() {
        try {
            const apiUrl = `${apiConfig.backendApiUrl}/api/mood?limit=7`;
            const response = await fetch(apiUrl, {
                method: 'GET',
                headers
            });
            
            if (response.ok) {
                const data = await response.json();
                if (data.success && data.data.length > 0) {
                    createMoodChart(data.data);
                    populateRecentMoodEntries(data.data);
                } else {
                    showEmptyMoodState();
                }
            } else {
                console.warn('Could not load mood history');
                showEmptyMoodState();
            }
        } catch (error) {
            console.error('Error loading mood history:', error);
            showEmptyMoodState();
        }
    }
    
    function createMoodChart(moodData) {
        const ctx = document.getElementById('mood-trend-chart').getContext('2d');
        
        // Prepare data for chart (reverse to show oldest to newest)
        const chartData = moodData.reverse();
        const labels = chartData.map(entry => {
            const date = new Date(entry.createdAt);
            return date.toLocaleDateString(undefined, { 
                month: 'short', 
                day: 'numeric'
            });
        });
        
        const data = chartData.map(entry => entry.value);
        const moodLabels = ['Angry', 'Disgust', 'Fear', 'Happy', 'Neutral', 'Sad', 'Surprise'];
        
        const gradient = ctx.createLinearGradient(0, 0, 0, 300);
        gradient.addColorStop(0, 'rgba(64, 115, 192, 0.3)');
        gradient.addColorStop(1, 'rgba(64, 115, 192, 0.05)');
        
        moodChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Mood Trend',
                    data: data,
                    backgroundColor: gradient,
                    borderColor: '#4073c0',
                    borderWidth: 3,
                    fill: true,
                    tension: 0.4,
                    pointBackgroundColor: '#4073c0',
                    pointBorderColor: '#ffffff',
                    pointBorderWidth: 2,
                    pointRadius: 6,
                    pointHoverRadius: 8
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        min: 0,
                        max: 6,
                        ticks: {
                            stepSize: 1,
                            callback: function(value) {
                                return moodLabels[value] || '';
                            }
                        },
                        grid: {
                            color: 'rgba(0, 0, 0, 0.1)'
                        }
                    },
                    x: {
                        grid: {
                            color: 'rgba(0, 0, 0, 0.1)'
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        callbacks: {
                            title: function(context) {
                                const index = context[0].dataIndex;
                                const entry = chartData[index];
                                const date = new Date(entry.createdAt);
                                return date.toLocaleString();
                            },
                            label: function(context) {
                                const value = context.raw;
                                return `Mood: ${moodLabels[value]}`;
                            }
                        }
                    }
                }
            }
        });
    }
    
    function populateRecentMoodEntries(moodData) {
        const container = document.getElementById('recent-mood-entries');
        const moodEmojis = {
            'Angry': 'ðŸ˜ ',
            'Disgust': 'ðŸ¤¢',
            'Fear': 'ðŸ˜¨',
            'Happy': 'ðŸ˜„',
            'Neutral': 'ðŸ˜',
            'Sad': 'ðŸ˜¢',
            'Surprise': 'ðŸ˜²'
        };
        
        container.innerHTML = '';
        
        moodData.slice(0, 7).forEach(entry => {
            const date = new Date(entry.createdAt);
            const moodEntry = document.createElement('div');
            moodEntry.className = 'mood-entry';
            
            moodEntry.innerHTML = `
                <div class="mood-entry-date">
                    ${date.toLocaleDateString(undefined, { 
                        month: 'short', 
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    })}
                </div>
                <div class="mood-entry-info">
                    <span class="mood-emoji">${moodEmojis[entry.label] || 'ðŸ¤”'}</span>
                    <span class="mood-label">${entry.label}</span>
                    <span class="mood-method ${entry.capturedVia}">${entry.capturedVia === 'ai' ? 'AI' : 'Manual'}</span>
                </div>
            `;
            
            container.appendChild(moodEntry);
        });
    }
    
    function showEmptyMoodState() {
        const container = document.getElementById('recent-mood-entries');
        container.innerHTML = `
            <div style="text-align: center; padding: 40px 20px; color: #6b7280;">
                <i class="fas fa-chart-line" style="font-size: 48px; margin-bottom: 16px; opacity: 0.5;"></i>
                <p>No mood data available yet.</p>
                <p><a href="mood.html" style="color: #4073c0;">Track your first mood</a> to see trends here.</p>
            </div>
        `;
        
        // Hide chart container
        const chartContainer = document.getElementById('mood-trend-chart').parentElement;
        chartContainer.innerHTML = `
            <div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #6b7280; flex-direction: column;">
                <i class="fas fa-chart-area" style="font-size: 64px; margin-bottom: 16px; opacity: 0.3;"></i>
                <p>Mood trend will appear here once you start tracking</p>
            </div>
        `;
    }
    
    async function checkProfileCompletion() {
        try {
            const apiUrl = `${apiConfig.backendApiUrl}/api/user/profile/completion`;
            const response = await fetch(apiUrl, {
                method: 'GET',
                headers
            });
            
            if (response.ok) {
                const data = await response.json();
                if (data.success) {
                    const completionPercentage = data.completionPercentage;
                    
                    // Show completion notice if profile is not fully complete
                    if (completionPercentage < 80) {
                        const notice = document.getElementById('profile-completion-notice');
                        const percentageElement = document.getElementById('completion-percentage');
                        
                        if (notice && percentageElement) {
                            percentageElement.textContent = `${completionPercentage}%`;
                            notice.style.display = 'block';
                        }
                    }
                }
            }
        } catch (error) {
            console.error('Error checking profile completion:', error);
        }
    }
    
    function setupProfileDropdown() {
        const profileTrigger = document.getElementById('profile-trigger');
        const profileDropdown = document.getElementById('profile-dropdown');
        
        if (!profileTrigger || !profileDropdown) return;
        
        // Remove any previous event listeners
        profileTrigger.onclick = null;
        document.removeEventListener('click', closeDropdownOnClickOutside, true);
        
        // Toggle dropdown on trigger click
        profileTrigger.addEventListener('click', function(e) {
            e.stopPropagation();
            profileDropdown.classList.toggle('active');
        });
        
        // Close dropdown when clicking outside
        document.addEventListener('click', closeDropdownOnClickOutside, true);
        
        function closeDropdownOnClickOutside(event) {
            if (!profileTrigger.contains(event.target) && !profileDropdown.contains(event.target)) {
                profileDropdown.classList.remove('active');
            }
        }
    }
});
    </script>

        </body>
    </html>